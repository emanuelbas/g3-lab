<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
<div class="content">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="card-box task-detail">
                    <div class="media mt-0 m-b-30">
                        <div class="media-body">
                            <h5 class="media-heading mb-0 mt-0">Detalles de Estudio</h5><span class="badge badge-danger">{{estudio.estado.nombre}}</span></div>
                    </div>
                    <h4 class="m-b-20">Información general del estudio</h4>
                    <p class="text-muted">{{estudio.detalleDelDiagnostico}}</p>
                    <p class="text-muted">En este texto se podría ir incluyendo detalles relvantes junto con URLS que permitan recuperar datos de los estados anteriores</p>

                    <ul class="list-inline task-dates m-b-0 mt-5">
                        <li>
                            <h5 class="m-b-5">Fecha de Creación</h5>
                            <p>{{estudio.createdAt}} <small class="text-muted">1:00 PM</small></p>
                        </li>
                        <li>
                            <h5 class="m-b-5">Medico Derivante</h5>
                            <p>{{estudio.medicoDerivante.email}}</p>
                        </li>
                        <li>
                            <h5 class="m-b-5">Paciente</h5>
                            <p>{{estudio.paciente.email}}</p>
                        </li>
                        <li>
                            <h5 class="m-b-5">Tipo de Estudio</h5>
                            <p><span class="badge badge-primary">{{estudio.tipoDeEstudio.nombre}}</span></p>
                        </li>
                        <li>
                            <h5 class="m-b-5">Diagnóstico Presuntivo</h5>
                            <p><span class="badge badge-secondary">{{estudio.diagnosticoPresuntivo.nombre}}</span></p>
                        </li>
                        <li>
                            <h5 class="m-b-5">Detalles del Diagnóstico Presuntivo</h5>
                            <p>{{estudio.detalleDelDiagnostico}}</p>
                        </li>
                        <li *ngIf="estudio.obraSocial">
                          <h5 class="m-b-5">Obra Social</h5>
                          <p>{{estudio.obraSocial.nombre}}</p>
                      </li>

                    </ul>

                    <div class="assign-team mt-4">
                        <h5 class="m-b-5">Acciones</h5>
                        <div>
                            <a href="/api/descargar-presupuesto/{{estudio._id}}" *ngIf="estudioConEstado.verBotonBajarPresupuesto()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info m-2" download>Descargar presupuesto</a>

                            <a href="/api/descargar-presupuesto/{{estudio._id}}" *ngIf="estudioConEstado.verBotonBajarPresupuestoLegado()" class="btn btn-info m-2" download>Descargar presupuesto</a>

                            <button *ngIf="estudioConEstado.verBotonSubirComprobanteDePago()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Subir comprobante de pago</button>
                            <button *ngIf="estudioConEstado.verBotonBajarComprobanteDePago()" class="btn btn-info ml-2">Bajar comprobante de pago</button>

                            <button *ngIf="estudioConEstado.verBotonBajarCI()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Enviar consentimiento informado a paciente</button>
                            <button *ngIf="estudioConEstado.verBotonSubirCIF()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Subir consentimiento informado firmado</button>
                            <button *ngIf="estudioConEstado.verBotonSeleccionarTurno()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Seleccion de turno  <small class="text-muted">(test)</small></button>
                            <button *ngIf="estudioConEstado.verBotonMuestraTomada()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Se tomó la muestra  <small class="text-muted">(test)</small></button>
                            <button *ngIf="estudioConEstado.verBotonMuestraRetirada()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Muestra retirada</button>
                            <button *ngIf="estudioConEstado.verBotonInciarProcesamiento()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info m-2">Iniciar procesamiento ya que se retiraron 10 muestras <small class="text-muted">(test)</small></button>
                            <button *ngIf="estudioConEstado.verBotonSubirResultado()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Subir resultado del lote</button>
                            <button *ngIf="estudioConEstado.verBotonSubirInterpretacion()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Subir interpretación de resultado</button>
                            <button *ngIf="estudioConEstado.verBotonEntregado()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info ml-2">Los resultados fueron envidos al Medico Derivante</button>

                            <button (click)="estudioConEstado.reiniciarEstado(estudio._id,estudioService)" class="btn btn-primary">Reiniciar estado <small class="text-muted">(test)</small></button>

                            <a href="/api/descargar-presupuesto/{{estudio._id}}" *ngIf="estudioConEstado.verBotonBajarPresupuesto()" (click)="estudioConEstado.siguiente(estudio._id,estudioService)" class="btn btn-info m-2" download><small class="text-muted">(test)</small></a>
                        
                            <!--

                              PROBANDO EL UPLOAD
                              
                            -->
                            <div class="input-group" *ngIf="estudioConEstado.verBotonSubirComprobanteDePago()">
                              
                              <div class="input-group-prepend">
                                <span  class="input-group-text upload"  (click)="upload(estudio._id)"  id="btnUpload">Subir comprobante de pago</span>
                              </div>

                              <div class="custom-file">
                                  <form action="/api/upload" method="post" enctype="multipart/form-data">
                                    <input  (change)="fileChange($event)"  type="file"  class="custom-file-input"  id="inputGroupFile01"  aria-describedby="inputGroupFileAddon01">
                                  </form>

                                  <label class="custom-file-label" for="inputGroupFile01">Seleccionar archivo</label>
                              </div>

                            </div>
                           
                        
                          </div>
                    </div>

                </div>

            </div>
            <!-- end col -->
            <div class="col-12 col-md-12">
              <h4 class="header-title m-b-30">Historial del Estudio</h4>

              <table style="width: 100%;" >
                <thead>
                  <tr>
                    <th>
                      <strong> Estado Acctual:</strong>
                    </th>
                    <th>
                      <strong>fecha inicio:</strong>
                    </th>
                    <th>
                      <strong>fecha fin:</strong>
                    </th>
                    <th>
                      <strong>Usuario:</strong>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let historia of listas">
                    <td>
                      <a>{{historia.estado.nombre}}</a>
                    </td>
                    <td>
                      <a>{{historia.fechaInicio |date:'dd/MM/yyyy' }}</a>
                    </td>
                    <td>
                      <a>{{historia.fechaFin |date:'dd/MM/yyyy'}}</a>
                    </td>
                    <td>
                      <a>{{historia.user.email}}</a>
                    </td>
                  </tr>
                </tbody>

              </table>
              <button class="btn btn-primary" (click)="backNavigate()">
                Volver
              </button>

            </div>
            <!-- end col -->
        </div>
        <!-- end row -->
    </div>
    <!-- container -->
</div>
